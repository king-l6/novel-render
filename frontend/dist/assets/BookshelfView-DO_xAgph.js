import{d as R,u as V,p as z,c as g,a as s,t as c,e as n,g as b,b as x,w as d,B as D,S as j,r as h,q as w,n as u,o as i,l as F,C as S,s as L,v as X,f as C,E as A,h as I}from"./index-fns_V41u.js";const M={class:"min-h-screen bg-gray-50 pb-8"},U={class:"sticky top-0 z-10 flex items-center justify-between px-4 py-3 bg-white border-b border-gray-200 shadow-sm"},q={class:"flex items-center gap-3"},W={class:"text-sm text-gray-500"},Y={key:0,href:"/admin.html",class:"text-sm text-blue-600 hover:underline"},G={class:"container mx-auto px-4 pt-6"},H={class:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4"},J={class:"flex-1 flex flex-col"},K={class:"w-full aspect-[3/4] bg-gradient-to-br from-amber-100 to-amber-200 rounded mb-2 flex items-center justify-center text-amber-800 text-2xl font-serif"},O=["title"],P={class:"text-xs text-gray-500 mt-1"},ee=R({__name:"BookshelfView",setup(Q){const m=I(),f=V(),p=h([]),o=h(!0),y=h(null);function k(a){const e=new Date(a);return Number.isNaN(e.getTime())?"":`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`}async function _(){o.value=!0;try{p.value=await w.get("/api/books")}catch(a){u.error(a instanceof Error?a.message:"åŠ è½½ä¹¦æ¶å¤±è´¥")}finally{o.value=!1}}function B(a){m.push({name:"Reader",params:{id:String(a)}})}function N(){var a;(a=y.value)==null||a.click()}async function T(a){var v;const e=a.target,t=(v=e.files)==null?void 0:v[0];if(!t||!t.name.toLowerCase().endsWith(".txt")){u.warning("è¯·é€‰æ‹© TXT æ–‡ä»¶"),e.value="";return}const r=await t.text(),E=String(r).replace(/\r\n/g,`
`).replace(/\r/g,`
`);try{const l=await w.post("/api/books",{title:t.name.replace(/\.txt$/i,""),file_name:t.name,content:E,size:t.size});u.success("å·²åŠ å…¥ä¹¦æ¶"),e.value="",await _(),m.push({name:"Reader",params:{id:String(l.id)}})}catch(l){u.error(l instanceof Error?l.message:"ä¸Šä¼ å¤±è´¥")}}async function $(){await f.logout(),m.replace("/login")}return z(()=>{_()}),(a,e)=>(i(),g("div",M,[s("header",U,[e[1]||(e[1]=s("h1",{class:"text-lg font-semibold text-gray-800"},"ğŸ“– ä¹¦æ¶",-1)),s("div",q,[s("span",W,c(n(f).userName),1),n(f).isAdmin?(i(),g("a",Y,"ç®¡ç†")):b("",!0),x(n(D),{size:"small",onClick:$},{default:d(()=>[...e[0]||(e[0]=[F("é€€å‡º",-1)])]),_:1})])]),s("main",G,[x(n(j),{spinning:o.value},{default:d(()=>[s("div",H,[x(n(S),{class:"cursor-pointer border-2 border-dashed border-gray-300 hover:border-blue-400 hover:bg-blue-50/50 transition-all flex flex-col min-h-[180px] justify-center items-center",onClick:N},{default:d(()=>[s("input",{ref_key:"fileInputRef",ref:y,type:"file",accept:".txt",class:"hidden",onChange:T},null,544),e[2]||(e[2]=s("div",{class:"text-4xl mb-2"},"â•",-1)),e[3]||(e[3]=s("div",{class:"text-sm font-medium text-gray-600"},"å¯¼å…¥ TXT",-1)),e[4]||(e[4]=s("div",{class:"text-xs text-gray-400 mt-1"},"ç‚¹å‡»æˆ–æ‹–æ‹½ä¸Šä¼ ",-1))]),_:1}),(i(!0),g(L,null,X(p.value,t=>(i(),C(n(S),{key:t.id,class:"cursor-pointer hover:shadow-lg transition-shadow min-h-[180px] flex flex-col",onClick:r=>B(t.id)},{default:d(()=>{var r;return[s("div",J,[s("div",K,c(((r=t.title)==null?void 0:r.charAt(0))||"ä¹¦"),1),s("div",{class:"text-sm font-medium text-gray-800 truncate",title:t.title},c(t.title||t.file_name),9,O),s("div",P,c(t.percent!=null&&t.percent>0?`è¯»åˆ° ${t.percent}%`:k(t.created_at)),1)])]}),_:2},1032,["onClick"]))),128))]),!o.value&&p.value.length===0?(i(),C(n(A),{key:0,description:"æš‚æ— ä¹¦ç±ï¼Œç‚¹å‡»ã€Œå¯¼å…¥ TXTã€æ·»åŠ ",class:"py-12"})):b("",!0)]),_:1},8,["spinning"])])]))}});export{ee as default};
