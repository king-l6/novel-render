import{d as V,u as j,p as F,x as L,c as S,a,t as f,e as n,f as y,w as o,R as A,g as C,b as h,B as M,S as X,r as p,q as k,n as l,o as c,j as B,C as D,y as b,z as I,s as U,D as q,E as O,l as W}from"./index-OB4_tYqa.js";const Y={class:"min-h-screen bg-gray-50 pb-8"},G={class:"sticky top-0 z-10 flex items-center justify-between px-4 py-3 bg-white border-b border-gray-200 shadow-sm"},H={class:"flex items-center gap-3"},J={class:"text-sm text-gray-500"},K={class:"container mx-auto px-4 pt-6"},P={class:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4"},Q={class:"flex-1 flex flex-col"},Z={class:"w-full aspect-[3/4] bg-gradient-to-br from-amber-100 to-amber-200 rounded mb-2 flex items-center justify-center text-amber-800 text-2xl font-serif"},ee=["title"],te={class:"text-xs text-gray-500 mt-1"},re=V({__name:"BookshelfView",setup(se){const m=W(),g=j(),x=p([]),d=p(!0),_=p(null),u=p(!1);function T(t){const e=new Date(t);return Number.isNaN(e.getTime())?"":`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`}async function v(){d.value=!0;try{x.value=await k.get("/api/books")}catch(t){l.error(t instanceof Error?t.message:"åŠ è½½ä¹¦æ¶å¤±è´¥")}finally{d.value=!1}}function $(t){m.push({name:"Reader",params:{id:String(t)}})}function N(){var t;(t=_.value)==null||t.click()}async function w(t){if(!t.name.toLowerCase().endsWith(".txt")){l.warning("è¯·é€‰æ‹© TXT æ–‡ä»¶");return}const e=await t.text(),s=String(e).replace(/\r\n/g,`
`).replace(/\r/g,`
`),r=await k.post("/api/books",{title:t.name.replace(/\.txt$/i,""),file_name:t.name,content:s,size:t.size});l.success("å·²åŠ å…¥ä¹¦æ¶"),await v(),m.push({name:"Reader",params:{id:String(r.id)}})}async function R(t){var r;const e=t.target,s=(r=e.files)==null?void 0:r[0];if(e.value="",!!s)try{await w(s)}catch(i){l.error(i instanceof Error?i.message:"ä¸Šä¼ å¤±è´¥")}}async function z(t){var s,r;u.value=!1;const e=(r=(s=t.dataTransfer)==null?void 0:s.files)==null?void 0:r[0];if(e)try{await w(e)}catch(i){l.error(i instanceof Error?i.message:"ä¸Šä¼ å¤±è´¥")}}async function E(){await g.logout(),m.replace("/login")}return F(()=>{v()}),L(()=>{v()}),(t,e)=>(c(),S("div",Y,[a("header",G,[e[4]||(e[4]=a("h1",{class:"text-lg font-semibold text-gray-800"},"ğŸ“– ä¹¦æ¶",-1)),a("div",H,[a("span",J,f(n(g).userName),1),n(g).isAdmin?(c(),y(n(A),{key:0,to:"/admin",class:"text-sm text-blue-600 hover:underline"},{default:o(()=>[...e[2]||(e[2]=[B("ç®¡ç†",-1)])]),_:1})):C("",!0),h(n(M),{size:"small",onClick:E},{default:o(()=>[...e[3]||(e[3]=[B("é€€å‡º",-1)])]),_:1})])]),a("main",K,[h(n(X),{spinning:d.value},{default:o(()=>[a("div",P,[h(n(D),{class:I(["cursor-pointer border-2 border-dashed transition-all flex flex-col min-h-[180px] justify-center items-center",u.value?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-blue-400 hover:bg-blue-50/50"]),onClick:N,onDragover:e[0]||(e[0]=b(s=>u.value=!0,["prevent"])),onDragleave:e[1]||(e[1]=b(s=>u.value=!1,["prevent"])),onDrop:b(z,["prevent"])},{default:o(()=>[a("input",{ref_key:"fileInputRef",ref:_,type:"file",accept:".txt",class:"hidden",onChange:R},null,544),e[5]||(e[5]=a("div",{class:"text-4xl mb-2"},"â•",-1)),e[6]||(e[6]=a("div",{class:"text-sm font-medium text-gray-600"},"å¯¼å…¥ TXT",-1)),e[7]||(e[7]=a("div",{class:"text-xs text-gray-400 mt-1"},"ç‚¹å‡»æˆ–æ‹–æ‹½ä¸Šä¼ ",-1))]),_:1},8,["class"]),(c(!0),S(U,null,q(x.value,s=>(c(),y(n(D),{key:s.id,class:"cursor-pointer hover:shadow-lg transition-shadow min-h-[180px] flex flex-col",onClick:r=>$(s.id)},{default:o(()=>{var r;return[a("div",Q,[a("div",Z,f(((r=s.title)==null?void 0:r.charAt(0))||"ä¹¦"),1),a("div",{class:"text-sm font-medium text-gray-800 truncate",title:s.title},f(s.title||s.file_name),9,ee),a("div",te,f(s.percent!=null&&s.percent>0?`è¯»åˆ° ${s.percent}%`:T(s.created_at)),1)])]}),_:2},1032,["onClick"]))),128))]),!d.value&&x.value.length===0?(c(),y(n(O),{key:0,description:"æš‚æ— ä¹¦ç±ï¼Œç‚¹å‡»ã€Œå¯¼å…¥ TXTã€æ·»åŠ ",class:"py-12"})):C("",!0)]),_:1},8,["spinning"])])]))}});export{re as default};
