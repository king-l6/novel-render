# 自家电脑 + Cloudflare Tunnel 部署

用本机跑服务，再通过 Cloudflare 的免费隧道把网站暴露到公网，手机/其他设备通过 HTTPS 链接即可访问。**不绑卡、完全免费、部署简单**。

---

## 特点

- **不绑卡**：无需注册云平台、无需信用卡
- **免费**：Cloudflare Tunnel 免费，本机跑项目无额外费用
- **数据在本地**：书籍和进度在 `server/data/novel-reader.db`，可随时备份
- **条件**：用的时候电脑要开着，并保持两个终端在运行

---

## 前置要求

- 本机已安装 **Node.js**（建议 18+）和 **pnpm**（`npm install -g pnpm`）
- 已安装 **cloudflared**：
  - **Mac**：`brew install cloudflared`
  - **Windows**：到 [cloudflared  releases](https://github.com/cloudflare/cloudflared/releases) 下载并加入系统 Path

---

## 部署步骤

### 1. 安装依赖并构建

在**项目根目录**打开终端，执行：

```bash
pnpm install
pnpm run build
```

### 2. 启动本机服务

在同一目录执行：

```bash
pnpm start
```

看到类似 `Listening on port 3000` 的提示后，在浏览器打开 [http://localhost:3000](http://localhost:3000)，确认能访问、能登录。

### 3. 暴露到公网

**再开一个终端**（不要关掉运行 `pnpm start` 的那个），执行：

```bash
cloudflared tunnel --url http://localhost:3000
```

终端里会输出一行类似：

```text
https://xxxx-xx-xx-xx-xx.trycloudflare.com
```

用手机或其他设备的浏览器打开这个 **https** 链接，即可在外网访问你的小说阅读器。

### 4. 登录与安全

- 默认账号：**admin** / **admin123**
- 建议首次登录后到「管理」里**修改默认密码**，避免被他人猜到。

---

## 下次使用

1. **终端一**（项目根目录）：`pnpm start`
2. **终端二**：`cloudflared tunnel --url http://localhost:3000`，用终端里给出的新链接访问（每次运行链接可能变化）

无需重新 `pnpm install` 或 `pnpm run build`，除非你改过代码。

---

## 数据与备份

- 书籍和阅读进度保存在 **server/data/novel-reader.db**
- 数据在你这台电脑上，可定期复制该文件做备份
- 关闭 `pnpm start` 或关机后，外网链接会失效，下次按「下次使用」再开即可

---

## 常见问题

**Q：链接每次都会变吗？**  
A：使用 `cloudflared tunnel --url ...` 这种快速隧道时，每次运行会生成新链接。若需要固定域名，可参考 [Cloudflare Tunnel 文档](https://developers.cloudflare.com/cloudflare-one/connections/connect-apps/) 配置命名隧道。

**Q：关掉终端后别人还能访问吗？**  
A：不能。关掉「终端一」服务就停了；关掉「终端二」隧道就断了，外网无法访问。

**Q：本机用 npm 可以吗？**  
A：可以。把文档里的 `pnpm install`、`pnpm run build`、`pnpm start` 换成 `npm install`、`npm run build`、`npm start` 即可。
